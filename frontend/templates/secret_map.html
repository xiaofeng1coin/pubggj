<!-- secret_map.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>密室点位图工具</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- 确保这里的路径是正确的 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/map_tool.css') }}">
</head>
<body>
    <div class="background-effects"></div>
    <a href="/" class="back-link">← 返回首页</a>

    <div class="container">
        <header class="tool-header">
            <h1>密室点位图工具</h1>
            <p>交互式地图，洞悉战场先机</p>
        </header>

        <main class="map-tool-grid">
            <!-- 控制面板 (左侧) -->
            <aside class="control-panel">
                <div class="form-group">
                    <label for="map-select">选择地图</label>
                    <div class="select-wrapper">
                        <select id="map-select">
                            {% for map_key, map_data in maps.items() %}
                            <option value="{{ map_key }}">{{ map_data.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="control-section coordinate-display">
                    <h4>坐标系信息</h4>
                    <p class="info-text">坐标系基于游戏内截图，X轴范围: <strong>420 ~ 1500</strong>, Y轴范围: <strong>0 ~ 1080</strong>。</p>
                    <div class="coords-info">
                        <span>点击坐标:</span>
                        <code id="clicked-coords-display">(---, ---)</code>
                    </div>
                </div>

                <div class="control-section">
                    <h4>标记我的位置</h4>
                    <div class="form-group">
                        <label for="player-x">玩家 X 坐标</label>
                        <input type="number" id="player-x" placeholder="范围: 420 ~ 1500">
                    </div>
                    <div class="form-group">
                        <label for="player-y">玩家 Y 坐标</label>
                        <input type="number" id="player-y" placeholder="范围: 0 ~ 1080">
                    </div>
                    <button id="mark-player-btn" class="btn-primary">
                        <span class="btn-text">标记玩家位置</span>
                    </button>
                </div>

                <div class="control-section">
                    <h4>查询密室信息</h4>
                     <p class="info-text">点击地图上的密室图标或输入坐标查询。</p>
                    <div class="form-group">
                        <label for="target-x">目标 X 坐标</label>
                        <input type="number" id="target-x" placeholder="点击地图或手动输入">
                    </div>
                    <div class="form-group">
                        <label for="target-y">目标 Y 坐标</label>
                        <input type="number" id="target-y" placeholder="点击地图或手动输入">
                    </div>
                    <button id="find-secret-btn" class="btn-secondary">
                        <span class="btn-text">查找附近密室</span>
                    </button>
                </div>
                 <div class="error-message" id="error-message"></div>
            </aside>

            <!-- 显示区域 (右侧) -->
            <div class="display-area">
                <div class="map-container" id="map-container">
                    <div class="loading-overlay visible" id="map-loader">
                        <div class="spinner"></div>
                    </div>
                    <img id="map-image" src="" alt="游戏地图">
                    <!-- 玩家标记点 -->
                    <div id="player-marker" class="map-marker player-marker">
                        <div class="pulse"></div>
                    </div>
                    <!-- 密室标记点的容器 -->
                    <div id="secret-markers-container"></div>
                </div>

                <div class="secret-info-panel" id="secret-info-panel">
                    <div class="loading-overlay" id="secret-loader">
                        <div class="spinner"></div>
                    </div>
                    <div class="content" id="secret-content">
                        <img id="secret-image" src="" alt="密室详细图片">
                        <h3 id="secret-name">密室详情</h3>
                    </div>
                    <div class="placeholder" id="secret-placeholder">
                        <p>查询或点击地图上的密室以查看详情</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 图片放大模态窗口 -->
    <div id="image-modal" class="modal-overlay">
        <span class="modal-close">&times;</span>
        <div class="modal-content">
            <img id="modal-image" src="" alt="密室详情大图">
            <div id="modal-caption"></div>
        </div>
    </div>

    <!-- 确保这里的路径是正确的 -->
    <script src="{{ url_for('static', filename='js/map_tool.js') }}"></script>
</body>
</html>
